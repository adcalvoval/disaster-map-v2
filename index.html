<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Capacity Assessment and Emergency Response Planning Tool</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23e74c3c'/%3E%3Crect x='6' y='4' width='4' height='8' fill='white'/%3E%3Crect x='4' y='6' width='8' height='4' fill='white'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <h1>Health Capacity Assessment and Emergency Response Planning Tool</h1>
        <div class="controls">
            <div class="filter-controls">
                <select id="alertLevel">
                    <option value="">All Alert Levels</option>
                    <option value="GREEN">Green</option>
                    <option value="ORANGE">Orange</option>
                    <option value="RED">Red</option>
                </select>
                <label class="checkbox-label">
                    <input type="checkbox" id="showAffectedAreas" checked>
                    Show Disaster Events
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="showImpactZones">
                    Show Impact Zones
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="showHealthFacilities">
                    Show RCRC Health Facilities
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="showOtherHealthFacilities">
                    Show other health facilities
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="showSatelliteLayer">
                    Show satellite imagery
                </label>
                <button id="authEarthEngine" style="display: none;">Sign in with Google (Earth Engine)</button>
                <button id="refreshData">Refresh Data</button>
            </div>
        </div>
    </div>
    
    <!-- Health Facilities Controls -->
    <div id="healthFacilitiesControls" class="health-controls" style="display: block;">
        <div class="controls-header">
            <h4>Health Facilities</h4>
            <select id="healthCountryFilter" class="country-filter" multiple size="4">
                <!-- Countries will be dynamically populated -->
            </select>
            <select id="healthFunctionalityFilter" class="country-filter" style="margin-top: 5px;">
                <option value="">All Functionality Levels</option>
                <option value="fully">Fully Functional</option>
                <option value="partially">Partially Functional</option>
                <option value="not">Not Functional</option>
            </select>
        </div>
        <div class="facility-legend">
            <div class="legend-item">
                <input type="checkbox" id="show-primary-health" checked>
                <span class="legend-icon" style="background: #1e3a8a;">üè•</span>
                <label for="show-primary-health">Primary Health Care (912)</label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="show-hospitals" checked>
                <span class="legend-icon" style="background: #fbbf24; color: #000;">üè®</span>
                <label for="show-hospitals">Hospitals (253)</label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="show-ambulance" checked>
                <span class="legend-icon" style="background: #166534;">üöë</span>
                <label for="show-ambulance">Ambulance Stations (2,157)</label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="show-blood" checked>
                <span class="legend-icon" style="background: #8b0000;">ü©∏</span>
                <label for="show-blood">Blood Centres (876)</label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="show-pharmacies" checked>
                <span class="legend-icon" style="background: #84cc16;">üíä</span>
                <label for="show-pharmacies">Pharmacies (139)</label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="show-training" checked>
                <span class="legend-icon" style="background: #ea580c;">üéì</span>
                <label for="show-training">Training Facilities (268)</label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="show-specialized" checked>
                <span class="legend-icon" style="background: #a16207;">üî¨</span>
                <label for="show-specialized">Specialized Services (129)</label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="show-residential" checked>
                <span class="legend-icon" style="background: #7dd3fc; color: #000;">üè†</span>
                <label for="show-residential">Residential Facilities (171)</label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="show-other" checked>
                <span class="legend-icon" style="background: #374151;">‚öïÔ∏è</span>
                <label for="show-other">Other (630)</label>
            </div>
        </div>
    </div>
    
    <div id="map">
        <button id="fullscreenToggle" class="fullscreen-toggle" title="Toggle Fullscreen">
            <span class="fullscreen-icon">‚õ∂</span>
        </button>
    </div>
    
    <div class="sidebar">
        <!-- Disaster Events Section -->
        <div class="events-section" style="height: 50%; display: flex; flex-direction: column;">
            <div class="section-header">
                <h3>Disaster Events</h3>
                <div class="search-container">
                    <input type="text" id="eventSearch" placeholder="Search events..." class="search-input">
                    <button id="clearEventSearch" class="clear-search-btn" style="display: none;">√ó</button>
                    <button id="clearEventSelection" class="clear-selection-btn" style="display: none;" title="Show all events">‚¨ÖÔ∏è</button>
                </div>
            </div>
            <div id="eventList" style="flex: 1; overflow-y: auto;">
                Loading disaster events...
            </div>
        </div>
        
        <!-- RCRC Facilities Section -->
        <div id="impactFacilitiesSection" class="facilities-section" style="height: 50%; display: flex; flex-direction: column;">
            <div class="section-header">
                <h3>RCRC Health Facilities</h3>
                <div class="section-controls">
                    <select id="facilityCountryFilter" class="country-select">
                        <option value="">All Countries</option>
                    </select>
                </div>
            </div>
            <div id="impactFacilitiesList" class="facilities-list" style="flex: 1; overflow-y: auto;">
                Loading facilities...
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Created by <a href="https://github.com/adcalvoval/disaster-map-v2" target="_blank">Adri√°n Calvo-Valderrama</a> | International Federation of Red Cross and Red Crescent Societies (IFRC)</p>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/shpjs@4.0.4/dist/shp.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        // Initialize Google API when loaded
        function initGoogleAPI() {
            if (typeof gapi !== 'undefined') {
                gapi.load('auth2', function() {
                    console.log('Google API auth2 loaded successfully');
                });
            }
        }
        
        // Call init when DOM is ready
        if (typeof gapi !== 'undefined') {
            initGoogleAPI();
        } else {
            window.addEventListener('load', initGoogleAPI);
        }
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/earthengine/0.1.365/earthengine-api.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
